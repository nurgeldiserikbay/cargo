import{d as ee,u as oe,a as se,b as re,w as G,A as Z,r as m,o as N,c as H,e as n,f as r,g as L,t as l,h as e,p as T,m as be,i as j,j as ae,B as ue,C as me,D as pe,k as F,l as z,E as _e,n as he,z as fe,G as ve,R as ke,x as s,q as ye,F as ge,v as Ne,H as we}from"./entry.e02c836d.js";import{t as xe,z as g,u as Ce,a as Ue}from"./vee-validate-zod.esm.1adbbd66.js";import{u as Le}from"./branch.eaa901b7.js";import{u as $e}from"./location.fb6b0d77.js";const Ie={key:0},Ve={key:1},Be=ee({__name:"ControlUsers",props:{selectedUser:{}},emits:["clear","added"],setup(J,{emit:S}){const{$api:$}=ae(),{t:p}=oe(),h=J,I=S,{setLoading:c}=se(),{setError:f,setSuccess:A}=re(),E=xe(g.object({firstName:g.string().min(1).max(200),lastName:g.string().min(1).max(200),password:g.string().min(4),phoneNumber:g.string(),warehouseId:g.number(),email:g.string().email()})),{errors:M,values:t,handleSubmit:w,defineComponentBinds:R,handleReset:x,setValues:V}=Ce({validationSchema:E}),v=R("password");G(()=>h.selectedUser,()=>{h.selectedUser&&V(h.selectedUser)});const i=w(async()=>{var b,k;try{if(!t.firstName||!t.lastName||!t.phoneNumber||!t.password||!t.email||!t.warehouseId)return;c("global",!0);const{status:u,data:U,error:y}=h.selectedUser?await $.admin.updateAdmin(h.selectedUser.id,{firstName:t.firstName,lastName:t.lastName,phoneNumber:Z(t.phoneNumber||""),password:t.password,email:t.email,warehouseId:t.warehouseId}):await $.admin.createAdmin({firstName:t.firstName,lastName:t.lastName,phoneNumber:Z(t.phoneNumber||""),password:t.password,email:t.email,warehouseId:t.warehouseId});u.value==="success"&&(I("added",U.value),A({title:p("messages.successAdminCreate")}),x()),u.value==="error"&&f({title:p(`errors.${((b=y.value)==null?void 0:b.data)||""}`)})}catch(u){(k=u==null?void 0:u.response)!=null&&k._data&&f({title:u.response._data.error||""})}finally{c("global",!1)}},()=>{});function C(){x(),I("clear")}return(b,k)=>{const u=m("v-col"),U=m("v-row"),y=m("v-text-field"),q=m("v-btn"),O=m("v-container"),D=m("v-form");return N(),H(D,null,{default:n(()=>[r(O,null,{default:n(()=>[r(U,{class:"text-h6 text-left",justify:"space-between"},{default:n(()=>[r(u,null,{default:n(()=>[L(l(e(p)("titles.users")),1)]),_:1})]),_:1}),r(U,{align:"stretch"},{default:n(()=>[r(u,{cols:"12",md:"3"},{default:n(()=>[b.selectedUser?(N(),T("div",Ie,l(`${b.selectedUser.lastName} ${b.selectedUser.firstName}`),1)):(N(),T("div",Ve,l(e(p)("commands.selectUser")),1))]),_:1}),r(u,{cols:"12",md:"4"},{default:n(()=>[r(y,be(e(v),{label:e(p)("labels.password"),disabled:!b.selectedUser,"error-messages":("zodI18n"in b?b.zodI18n:e(Ue))(e(M).password)}),null,16,["label","disabled","error-messages"])]),_:1}),r(u,{cols:"12",md:"4",class:"flex center gap-5"},{default:n(()=>[r(q,{variant:"elevated",type:"submit",color:"secondary",size:"x-large",disabled:!b.selectedUser,onClick:j(e(i),["prevent"])},{default:n(()=>[L(l(e(p)("commands.update")),1)]),_:1},8,["disabled","onClick"]),r(q,{variant:"elevated",color:"error",size:"x-large",disabled:!b.selectedUser,onClick:j(C,["prevent"])},{default:n(()=>[L(l(e(p)("commands.clear")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})}}}),ze={class:"mt-4"},Se={class:"w-full"},Ae={class:"w-full"},Ee=s("th",{class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"}," â„– ",-1),Re={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},qe={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Pe={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Fe={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Te={class:"px-2 py-1 border-b-1 border-b-black border-b-solid"},je={class:"w-full"},Me={class:"w-full"},Oe={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},De={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Ge={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},He={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Je=s("td",{class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},null,-1),Ke=s("td",{class:"px-2 py-1 border-b-1 border-b-black border-b-solid"},null,-1),Qe={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},We={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},Xe={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},Ye={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},Ze={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},eo={class:"px-2 py-1 flex"},to=ee({__name:"users",async setup(J){let S,$;const p=$e(),h=Le(),{$api:I}=ae(),{t:c}=oe(),{setLoading:f}=se(),{setError:A}=re(),E=ue(),M=me(),t=pe(),w=F(),R=F(10),x=F(0),V=z(()=>Number(E.query.page)||1),v=F([]),i=_e({id:"",emailLike:"",firstNameLike:"",phoneNumberLike:""});let C=null;const b=z(()=>Math.ceil(x.value/R.value)),k=z(()=>d=>h.getBranchById(d)),u=z(()=>d=>{var o;return((o=k.value(d))==null?void 0:o.address)||""}),U=z(()=>d=>{var _,B;const o=(_=k.value(d))==null?void 0:_.locationId;return o===void 0?"":((B=p.getCityById(o))==null?void 0:B.name)||""||""});G(()=>V.value,()=>{y()}),G(()=>i,()=>{C&&(clearTimeout(C),C=null),C=setTimeout(()=>{y()},500)},{deep:!0}),[S,$]=he(()=>y()),await S,$(),fe(async()=>{await h.fetchBranches(),await p.fetchCities()});async function y(){var d;try{f("global",!0);const{data:o}=await I.admin.getAdmins({query:ve({size:R.value,page:V.value-1,authorityEqual:ke.ROLE_USER,codeEqual:i.id,emailLike:i.emailLike,firstNameLike:i.firstNameLike,phoneNumberLike:i.phoneNumberLike})});o.value&&(v.value=o.value.content,x.value=o.value.totalElements)}catch(o){(d=o==null?void 0:o.response)!=null&&d._data&&A({title:o.response._data.error||""})}finally{f("global",!1)}}function q(d){w.value?v.value=v.value.map(o=>o.id===d.id?d:o):v.value.unshift(d),K()}function O(d){w.value=d}async function D(d){var o;try{f("global",!0),await I.admin.removeAdmin(d.id)}catch(_){(o=_==null?void 0:_.response)!=null&&o._data&&A({title:_.response._data.error||""})}finally{f("global",!1)}}function K(){w.value=void 0}function te(d){M.push({path:t(E.path),query:{page:d}})}return(d,o)=>{const _=Be,B=m("v-divider"),P=m("v-text-field"),Q=m("v-tooltip"),W=m("v-icon"),X=m("v-btn"),le=m("v-table"),de=m("v-pagination"),ne=m("v-container");return N(),H(ne,null,{default:n(()=>[r(_,{"selected-user":e(w),onClear:K,onAdded:q},null,8,["selected-user"]),r(B,{inset:"",class:"my-4 !max-w-full !ms-0"}),s("div",ze,[s("span",null,l(e(c)("labels.totalCount")),1),L(": "),s("span",null,l(e(x)),1)]),r(le,{density:"comfortable",hover:!0,class:"table w-full mt-2"},{default:n(()=>[s("thead",Se,[s("tr",Ae,[Ee,s("th",Re,l(e(c)("labels.user")),1),s("th",qe,l(e(c)("labels.email")),1),s("th",Pe,l(e(c)("labels.phoneNumber")),1),s("th",Fe,l(e(c)("labels.branch")),1),s("th",Te,l(e(c)("labels.commands")),1)])]),s("tbody",je,[s("tr",Me,[s("td",Oe,[r(P,{modelValue:e(i).id,"onUpdate:modelValue":o[0]||(o[0]=a=>e(i).id=a),placeholder:e(c)("labels.search")},null,8,["modelValue","placeholder"])]),s("td",De,[r(P,{modelValue:e(i).firstNameLike,"onUpdate:modelValue":o[1]||(o[1]=a=>e(i).firstNameLike=a),placeholder:e(c)("labels.search")},null,8,["modelValue","placeholder"])]),s("td",Ge,[r(P,{modelValue:e(i).emailLike,"onUpdate:modelValue":o[2]||(o[2]=a=>e(i).emailLike=a),placeholder:e(c)("labels.search")},null,8,["modelValue","placeholder"])]),s("td",He,[r(P,{modelValue:e(i).phoneNumberLike,"onUpdate:modelValue":o[3]||(o[3]=a=>e(i).phoneNumberLike=a),placeholder:e(c)("labels.search")},null,8,["modelValue","placeholder"])]),Je,Ke]),(N(!0),T(ge,null,ye(e(v),(a,ce)=>{var Y;return N(),T("tr",{key:a.id,class:we(["w-full",{"bg-gray-300":ce%2===0}])},[s("td",Qe,l(a.id),1),s("td",We,l(`${a.lastName} ${a.firstName}`),1),s("td",Xe,l(a.email),1),s("td",Ye,l(a.phoneNumber),1),s("td",Ze,[s("div",null,l(`${e(U)(a.warehouseId)} - ${e(u)(a.warehouseId)}`),1),s("div",null,l((Y=e(k)(a.warehouseId))==null?void 0:Y.description),1)]),s("td",eo,[r(X,{variant:"plain",color:"primary",icon:!0,onClick:j(ie=>O(a),["stop"])},{default:n(()=>[r(Q,{activator:"parent",location:"top"},{default:n(()=>[L(l(e(c)("commands.select")),1)]),_:1}),r(W,{icon:"mdi mdi-button-pointer",size:"small"})]),_:2},1032,["onClick"]),r(X,{variant:"plain",color:"red",icon:!0,onClick:j(ie=>D(a),["stop"])},{default:n(()=>[r(Q,{activator:"parent",location:"top"},{default:n(()=>[L(l(e(c)("commands.delete")),1)]),_:1}),r(W,{icon:"mdi mdi-delete",size:"small"})]),_:2},1032,["onClick"])])],2)}),128))])]),_:1}),r(B,{inset:"",class:"my-4 !max-w-full !ms-0"}),e(b)>1?(N(),H(de,{key:0,"model-value":e(V),length:e(b),size:"x-small","onUpdate:modelValue":o[4]||(o[4]=a=>te(a))},null,8,["model-value","length"])):Ne("",!0)]),_:1})}}});export{to as default};
