import{v as fe,_ as he}from"./C9MPf_09.js";import{_ as ve}from"./DbiMNDjO.js";import{_ as ke}from"./BH6QT3IA.js";import{d as ae,u as le,a as te,b as de,k as M,w as W,C as re,r as p,o as A,c as X,e as t,f as o,g as G,t as b,h as e,m as L,x as ge,i as Y,j as ne,D as ye,E as Ne,G as we,l as D,H as Ie,n as xe,p as Le,I as Ve,R as ze,q as Ce,s as Q,z as r,F as $e,v as Ue,y as Ae,J as Se}from"./enCeUreN.js";import{t as Be,z as x,u as Ee,a as U}from"./CCLonOj_.js";import{u as Pe}from"./Cgqw2O-p.js";import{u as Re}from"./CyS3pdrx.js";const qe=ae({__name:"CreatePersonal",props:{selectedUser:{}},emits:["clear","added"],setup(ee,{emit:T}){const{$api:S}=ne(),{t:_}=le(),N=ee,B=T,{setLoading:i}=te(),{setError:w,setSuccess:E}=de(),H=Be(x.object({firstName:x.string().min(1).max(200),lastName:x.string().min(1).max(200),password:x.string().min(4),phoneNumber:x.string().refine(n=>fe.isMobilePhone(n.replace(/\D/g,""),"kk-KZ")),warehouseId:x.number(),email:x.string().email()})),{errors:h,values:d,handleSubmit:J,defineComponentBinds:f,handleReset:P,setValues:j}=Ee({validationSchema:H}),R=f("firstName"),m=f("lastName"),V=f("phoneNumber"),v=f("password"),O=f("warehouseId"),q=f("email"),z=M();W(()=>N.selectedUser,()=>{N.selectedUser&&j(N.selectedUser)});const K=J(async()=>{var n,I;try{if(!d.firstName||!d.lastName||!d.phoneNumber||!d.password||!d.email||!d.warehouseId)return;i("global",!0);const{status:c,data:C,error:g}=N.selectedUser?await S.admin.updateAdmin(N.selectedUser.id,{firstName:d.firstName,lastName:d.lastName,phoneNumber:re(d.phoneNumber||""),password:d.password,email:d.email,warehouseId:d.warehouseId}):await S.admin.createAdmin({firstName:d.firstName,lastName:d.lastName,phoneNumber:re(d.phoneNumber||""),password:d.password,email:d.email,warehouseId:d.warehouseId});c.value==="success"&&(B("added",C.value),E({title:_("messages.successAdminCreate")}),P()),c.value==="error"&&w({title:_(`errors.${((n=g.value)==null?void 0:n.data)||""}`)})}catch(c){(I=c==null?void 0:c.response)!=null&&I._data&&w({title:c.response._data.error||""})}finally{i("global",!1)}},()=>{});function F(){P(),B("clear")}return(n,I)=>{const c=p("v-col"),C=p("v-row"),g=p("v-text-field"),a=he,s=ve,k=ke,u=p("v-btn"),y=p("v-container"),$=p("v-form");return A(),X($,null,{default:t(()=>[o(y,null,{default:t(()=>[o(C,{class:"text-h6 text-left",justify:"space-between"},{default:t(()=>[o(c,null,{default:t(()=>[G(b(e(_)("titles.personal")),1)]),_:1})]),_:1}),o(C,{align:"stretch"},{default:t(()=>[o(c,{cols:"12",md:"3"},{default:t(()=>[o(g,L(e(R),{label:e(_)("labels.firstName"),"error-messages":("zodI18n"in n?n.zodI18n:e(U))(e(h).firstName)}),null,16,["label","error-messages"])]),_:1}),o(c,{cols:"12",md:"3"},{default:t(()=>[o(g,L(e(m),{label:e(_)("labels.lastName"),"error-messages":("zodI18n"in n?n.zodI18n:e(U))(e(h).lastName)}),null,16,["label","error-messages"])]),_:1}),o(c,{cols:"12",md:"3"},{default:t(()=>[o(a,L(e(V),{label:e(_)("labels.phoneNumber"),"error-messages":("zodI18n"in n?n.zodI18n:e(U))(e(h).phoneNumber)}),null,16,["label","error-messages"])]),_:1}),o(c,{cols:"12",md:"3"},{default:t(()=>[o(g,L(e(q),{label:e(_)("labels.email"),"error-messages":("zodI18n"in n?n.zodI18n:e(U))(e(h).email)}),null,16,["label","error-messages"])]),_:1}),o(c,{cols:"12",md:"4"},{default:t(()=>[o(g,L(e(v),{label:e(_)("labels.password"),"error-messages":("zodI18n"in n?n.zodI18n:e(U))(e(h).password)}),null,16,["label","error-messages"])]),_:1}),o(c,{cols:"12",md:"4"},{default:t(()=>[o(s,{modelValue:e(z),"onUpdate:modelValue":I[0]||(I[0]=Z=>ge(z)?z.value=Z:null)},null,8,["modelValue"])]),_:1}),o(c,{cols:"12",md:"4"},{default:t(()=>[o(k,L(e(O),{"city-id":e(z),errors:("zodI18n"in n?n.zodI18n:e(U))(e(h).warehouseId)}),null,16,["city-id","errors"])]),_:1}),o(c,{cols:"12",md:"4",class:"flex center gap-5"},{default:t(()=>[o(u,{variant:"elevated",type:"submit",color:"secondary",size:"x-large",onClick:Y(e(K),["prevent"])},{default:t(()=>[G(b(n.selectedUser?e(_)("commands.update"):e(_)("commands.submit")),1)]),_:1},8,["onClick"]),o(u,{variant:"elevated",color:"error",size:"x-large",onClick:Y(F,["prevent"])},{default:t(()=>[G(b(e(_)("commands.clear")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Fe={class:"overflow-y-hidden w-full hidden-scroll select-none"},De={class:"w-full"},Me={class:"w-full"},Te=r("th",{class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"}," â„– ",-1),je={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Oe={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Ge={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},He={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Je={class:"px-2 py-1 border-b-1 border-b-black border-b-solid"},Ke={class:"w-full"},Ze={class:"w-full"},Qe={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},We={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Xe={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Ye={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},eo=r("td",{class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},null,-1),oo=r("td",{class:"px-2 py-1 border-b-1 border-b-black border-b-solid"},null,-1),so={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},ro={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},ao={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},lo={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},to={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},no={class:"px-2 py-1 flex"},ho=ae({__name:"personals",async setup(ee){let T,S;const _=Re(),N=Pe(),{$api:B}=ne(),{t:i}=le(),{setLoading:w}=te(),{setError:E,setSuccess:H}=de(),h=ye(),d=Ne(),J=we(),f=M(),P=M(10),j=M(0),R=D(()=>Number(h.query.page)||1),m=Ie({id:"",emailLike:"",firstNameLike:"",phoneNumberLike:""});let V=null;const v=M([]),O=D(()=>Math.ceil(j.value/P.value)),q=D(()=>a=>N.getBranchById(a)),z=D(()=>a=>{var s;return((s=q.value(a))==null?void 0:s.address)||""}),K=D(()=>a=>{var k,u;const s=(k=q.value(a))==null?void 0:k.locationId;return s===void 0?"":((u=_.getCityById(s))==null?void 0:u.name)||""||""});W(()=>R.value,()=>{F()}),W(()=>m,()=>{V&&(clearTimeout(V),V=null),V=setTimeout(()=>{F()},500)},{deep:!0}),[T,S]=xe(()=>F()),await T,S();async function F(){var a;try{w("global",!0);const{data:s}=await B.admin.getAdmins({query:Ve({size:P.value,page:R.value-1,authorityEqual:ze.ROLE_MANAGER,codeEqual:m.id,emailLike:m.emailLike,firstNameLike:m.firstNameLike,phoneNumberLike:m.phoneNumberLike})});s.value&&(v.value=s.value.content,j.value=s.value.totalElements)}catch(s){(a=s==null?void 0:s.response)!=null&&a._data&&E({title:s.response._data.error||""})}finally{w("global",!1)}}function n(a){f.value?v.value=v.value.map(s=>s.id===a.id?a:s):v.value.unshift(a),c()}function I(a){f.value=a}function c(){f.value=void 0}async function C(a){var s,k;try{w("global",!0);const{status:u,error:y}=await B.admin.updateAdmin(a.id,{...a,locked:!a.locked});u.value==="success"&&(v.value=v.value.filter($=>$.id!==a.id),H({title:i("messages.successAdminRemove")})),u.value==="error"&&E({title:i(`errors.${((s=y.value)==null?void 0:s.data)||""}`)})}catch(u){(k=u==null?void 0:u.response)!=null&&k._data&&E({title:u.response._data.error||""})}finally{w("global",!1)}}function g(a){d.push({path:J(h.path),query:{page:a}})}return(a,s)=>{const k=qe,u=p("v-divider"),y=p("v-text-field"),$=p("v-tooltip"),Z=p("v-icon"),ce=p("v-btn"),ie=p("v-switch"),ue=p("v-table"),be=p("v-pagination"),me=p("v-container"),pe=Le("dragscroll");return A(),X(me,null,{default:t(()=>[o(k,{"selected-user":e(f),onClear:c,onAdded:n},null,8,["selected-user"]),o(u,{inset:"",class:"my-4 !max-w-full !ms-0"}),Ce((A(),Q("div",Fe,[o(ue,{density:"comfortable",hover:!0,class:"table w-full mt-2 min-w-[800px]"},{default:t(()=>[r("thead",De,[r("tr",Me,[Te,r("th",je,b(e(i)("labels.user")),1),r("th",Oe,b(e(i)("labels.email")),1),r("th",Ge,b(e(i)("labels.phoneNumber")),1),r("th",He,b(e(i)("labels.branch")),1),r("th",Je,b(e(i)("labels.commands")),1)])]),r("tbody",Ke,[r("tr",Ze,[r("td",Qe,[o(y,{modelValue:e(m).id,"onUpdate:modelValue":s[0]||(s[0]=l=>e(m).id=l),placeholder:e(i)("labels.search")},null,8,["modelValue","placeholder"])]),r("td",We,[o(y,{modelValue:e(m).firstNameLike,"onUpdate:modelValue":s[1]||(s[1]=l=>e(m).firstNameLike=l),placeholder:e(i)("labels.search")},null,8,["modelValue","placeholder"])]),r("td",Xe,[o(y,{modelValue:e(m).emailLike,"onUpdate:modelValue":s[2]||(s[2]=l=>e(m).emailLike=l),placeholder:e(i)("labels.search")},null,8,["modelValue","placeholder"])]),r("td",Ye,[o(y,{modelValue:e(m).phoneNumberLike,"onUpdate:modelValue":s[3]||(s[3]=l=>e(m).phoneNumberLike=l),placeholder:e(i)("labels.search")},null,8,["modelValue","placeholder"])]),eo,oo]),(A(!0),Q($e,null,Ue(e(v),(l,_e)=>{var oe;return A(),Q("tr",{key:l.id,class:Se(["w-full",{"bg-gray-300":_e%2===0}])},[r("td",so,b(l.id),1),r("td",ro,b(`${l.lastName} ${l.firstName}`),1),r("td",ao,b(l.email),1),r("td",lo,b(l.phoneNumber),1),r("td",to,[r("div",null,b(`${e(K)(l.warehouseId)} - ${e(z)(l.warehouseId)}`),1),r("div",null,b((oe=e(q)(l.warehouseId))==null?void 0:oe.description),1)]),r("td",no,[o(ce,{variant:"plain",color:"primary",icon:!0,onClick:Y(se=>I(l),["stop"])},{default:t(()=>[o($,{activator:"parent",location:"top"},{default:t(()=>[G(b(e(i)("commands.select")),1)]),_:1}),o(Z,{icon:"mdi mdi-button-pointer",size:"small"})]),_:2},1032,["onClick"]),o($,{color:"black",location:"top"},{activator:t(({props:se})=>[r("div",L({ref_for:!0},se),[o(ie,{"model-value":!l.locked,"hide-details":"",size:"small","onUpdate:modelValue":co=>C(l)},null,8,["model-value","onUpdate:modelValue"])],16)]),default:t(()=>[r("div",null,b(l.locked?e(i)("lables.unlock"):e(i)("labels.lock")),1)]),_:2},1024)])],2)}),128))])]),_:1})])),[[pe]]),o(u,{inset:"",class:"my-4 !max-w-full !ms-0"}),e(O)>1?(A(),X(be,{key:0,"model-value":e(R),length:e(O),size:"x-small","onUpdate:modelValue":s[4]||(s[4]=l=>g(l))},null,8,["model-value","length"])):Ae("",!0)]),_:1})}}});export{ho as default};
