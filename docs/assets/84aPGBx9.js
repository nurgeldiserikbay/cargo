import{d as H,c as I,a as P,w as J,L as K,N as b,o as k,j as S,ac as o,Q as a,a7 as d,ab as s,u as r,m as W,ah as V,X as Y,A as Z,ae as $}from"./9z15omkZ.js";import{u as ee,a as re,b as oe,d as ae,c as te}from"./BT9LgsZd.js";import{t as se,z,u as le,a as de}from"./Bidafszn.js";import{u as ce}from"./BO6X2MPq.js";const ne={key:0},_e=H({__name:"checkProduct",setup(ue){const g=ce(),{$api:y}=te(),{t:l}=ee(),{setLoading:_}=re(),{setError:p,setSuccess:T}=oe(),{data:C}=ae(),A=I(()=>t=>g.getBranchById(t)),j=I(()=>t=>{var n;return((n=A.value(t))==null?void 0:n.address)||""}),F=se(z.object({trackCode:z.string().min(1).max(500)})),{errors:L,values:i,handleSubmit:R,defineComponentBinds:D,handleReset:x}=le({validationSchema:F}),E=D("trackCode"),h=P(!1),u=P(null);let m=null;J(()=>i.trackCode,()=>{h.value&&(m&&clearTimeout(m),m=setTimeout(()=>{w()},300))}),K(async()=>{await g.fetchBranches()});const M=R(()=>{m&&clearTimeout(m),w()},()=>{});function O(t){return t.split(" ")}async function Q(){var t,n;try{if(!i.trackCode)return;_("global",!0);const{status:e,error:c,data:f}=await y.product.getProductOwnerById(i.trackCode);e.value==="success"&&(u.value=f.value,x()),e.value==="error"&&p({title:l(`errors.${((t=c.value)==null?void 0:t.data)||""}`)})}catch(e){(n=e==null?void 0:e.response)!=null&&n._data&&p({title:e.response._data.error||""})}finally{_("global",!1)}}async function w(){var t,n;try{if(!i.trackCode)return;_("global",!0);const e=O(i.trackCode),{status:c,error:f}=await y.product.updateByTrackCodes(e);c.value==="success"&&(T({title:l("messages.successProductRegistered")}),x()),c.value==="error"&&p({title:l(`errors.${((t=f.value)==null?void 0:t.data)||""}`)})}catch(e){(n=e==null?void 0:e.response)!=null&&n._data&&p({title:e.response._data.error||""})}finally{_("global",!1)}}return(t,n)=>{const e=b("v-col"),c=b("v-row"),f=b("v-text-field"),U=b("v-checkbox"),N=b("v-btn"),X=b("v-card"),q=b("v-form"),G=b("v-container");return k(),S(G,{class:"!pt-10"},{default:o(()=>[a(c,{class:"mb-10",justify:"space-between"},{default:o(()=>[a(e,{class:"text-h4 text-center"},{default:o(()=>{var v,B;return[d(s(r(l)("titles.checkProduct"))+" ",1),(v=r(C))!=null&&v.warehouseId?(k(),W("span",ne,"("+s(r(j)((B=r(C))==null?void 0:B.warehouseId))+")",1)):V("",!0)]}),_:1})]),_:1}),a(q,{class:"max-w-500px m-auto flex flex-col"},{default:o(()=>[a(f,Y(r(E),{label:r(l)("labels.trackCode"),"error-messages":("zodI18n"in t?t.zodI18n:r(de))(r(L).trackCode),"hide-details":"",clearable:!0,autofocus:!0,type:"textarea"}),null,16,["label","error-messages"]),a(U,{modelValue:r(h),"onUpdate:modelValue":n[0]||(n[0]=v=>Z(h)?h.value=v:null),label:r(l)("labels.autoFetch"),color:"indigo",value:"indigo","hide-details":"",class:"mb-5 self-end"},null,8,["modelValue","label"]),a(c,null,{default:o(()=>[a(N,{variant:"elevated",type:"submit",color:"secondary",size:"x-large",class:"m-auto",onClick:$(Q,["prevent"])},{default:o(()=>[d(s(r(l)("labels.search")),1)]),_:1}),a(N,{variant:"elevated",type:"submit",color:"primary",size:"x-large",class:"m-auto",onClick:$(r(M),["prevent"])},{default:o(()=>[d(s(r(l)("commands.submit")),1)]),_:1},8,["onClick"])]),_:1}),r(u)?(k(),S(X,{key:0,class:"mt-8 px-4 py-2"},{default:o(()=>[a(c,null,{default:o(()=>[a(e,{class:"border-r-1 border-r-solid border-r-#000 border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(l)("labels.description")),1)]),_:1}),a(e,{class:"border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(`${r(u).productDescription}`),1)]),_:1})]),_:1}),a(c,null,{default:o(()=>[a(e,{class:"border-r-1 border-r-solid border-r-#000 border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(l)("labels.city")),1)]),_:1}),a(e,{class:"border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(u).locationName),1)]),_:1})]),_:1}),a(c,null,{default:o(()=>[a(e,{class:"border-r-1 border-r-solid border-r-#000 border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(l)("labels.branch")),1)]),_:1}),a(e,{class:"border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(u).warehouseName),1)]),_:1})]),_:1}),a(c,null,{default:o(()=>[a(e,{class:"border-r-1 border-r-solid border-r-#000 border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(l)("labels.fullName")),1)]),_:1}),a(e,{class:"border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(`${r(u).lastName} ${r(u).firstName}`),1)]),_:1})]),_:1}),a(c,null,{default:o(()=>[a(e,{class:"border-r-1 border-r-solid border-r-#000 border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(l)("labels.phoneNumber")),1)]),_:1}),a(e,{class:"border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(u).phoneNumber),1)]),_:1})]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1})}}});export{_e as default};
