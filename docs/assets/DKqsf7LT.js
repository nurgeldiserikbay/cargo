import{d as re,u as le,a as oe,b as se,w as Y,C as ee,r as b,o as h,c as G,e as c,f as s,g as V,t,h as e,s as z,m as me,i as D,j as ae,D as pe,E as _e,G as ve,k as F,l as B,H as he,n as fe,B as ke,p as ye,I as we,R as ge,z as l,q as xe,K as Ne,F as Le,v as Ue,y as Ce,J as Ve}from"./DBCDSuVQ.js";import{t as $e,z as g,u as Ee,a as Ie}from"./Drm0Q-Yl.js";import{u as Se}from"./BtxfaNxF.js";import{u as Be}from"./BVTReDcz.js";const ze={key:0},Ae={key:1},Pe=re({__name:"ControlUsers",props:{selectedUser:{}},emits:["clear","added"],setup(H,{emit:A}){const{$api:$}=ae(),{t:p}=le(),v=H,E=A,{setLoading:a}=oe(),{setError:f,setSuccess:P}=se(),x=$e(g.object({firstName:g.string().min(1).max(200),lastName:g.string().min(1).max(200),password:g.string().min(4),phoneNumber:g.string(),warehouseId:g.number(),email:g.string().email()})),{errors:q,values:d,handleSubmit:N,defineComponentBinds:T,handleReset:L,setValues:I}=Ee({validationSchema:x}),k=T("password");Y(()=>v.selectedUser,()=>{v.selectedUser&&I(v.selectedUser)});const n=N(async()=>{var u,y;try{if(!d.firstName||!d.lastName||!d.phoneNumber||!d.password||!d.email||!d.warehouseId)return;a("global",!0);const{status:m,data:C,error:w}=v.selectedUser?await $.admin.updateAdmin(v.selectedUser.id,{firstName:d.firstName,lastName:d.lastName,phoneNumber:ee(d.phoneNumber||""),password:d.password,email:d.email,warehouseId:d.warehouseId}):await $.admin.createAdmin({firstName:d.firstName,lastName:d.lastName,phoneNumber:ee(d.phoneNumber||""),password:d.password,email:d.email,warehouseId:d.warehouseId});m.value==="success"&&(E("added",C.value),P({title:p("messages.successAdminCreate")}),L()),m.value==="error"&&f({title:p(`errors.${((u=w.value)==null?void 0:u.data)||""}`)})}catch(m){(y=m==null?void 0:m.response)!=null&&y._data&&f({title:m.response._data.error||""})}finally{a("global",!1)}},()=>{});function U(){L(),E("clear")}return(u,y)=>{const m=b("v-col"),C=b("v-row"),w=b("v-text-field"),R=b("v-btn"),O=b("v-container"),M=b("v-form");return h(),G(M,null,{default:c(()=>[s(O,null,{default:c(()=>[s(C,{class:"text-h6 text-left",justify:"space-between"},{default:c(()=>[s(m,null,{default:c(()=>[V(t(e(p)("titles.users")),1)]),_:1})]),_:1}),s(C,{align:"stretch"},{default:c(()=>[s(m,{cols:"12",md:"3"},{default:c(()=>[u.selectedUser?(h(),z("div",ze,t(`${u.selectedUser.lastName} ${u.selectedUser.firstName}`),1)):(h(),z("div",Ae,t(e(p)("commands.selectUser")),1))]),_:1}),s(m,{cols:"12",md:"4"},{default:c(()=>[s(w,me(e(k),{label:e(p)("labels.password"),disabled:!u.selectedUser,"error-messages":("zodI18n"in u?u.zodI18n:e(Ie))(e(q).password)}),null,16,["label","disabled","error-messages"])]),_:1}),s(m,{cols:"12",md:"4",class:"flex center gap-5"},{default:c(()=>[s(R,{variant:"elevated",type:"submit",color:"secondary",size:"x-large",disabled:!u.selectedUser,onClick:D(e(n),["prevent"])},{default:c(()=>[V(t(e(p)("commands.update")),1)]),_:1},8,["disabled","onClick"]),s(R,{variant:"elevated",color:"error",size:"x-large",disabled:!u.selectedUser,onClick:D(U,["prevent"])},{default:c(()=>[V(t(e(p)("commands.clear")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})}}}),qe={class:"mt-4"},Te={class:"overflow-y-hidden w-full hidden-scroll select-none"},Re={class:"w-full"},je={class:"w-full"},Fe=l("th",{class:"min-w-[80px] border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"}," â„– ",-1),De={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Oe={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Me={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Ye={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Ge={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid min-w-[100px]"},He={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid min-w-[100px]"},Je={class:"px-2 py-1 border-b-1 border-b-black border-b-solid"},Ke={class:"w-full"},Qe={class:"w-full"},We={class:"min-w-[80px] border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Xe={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Ze={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},er={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},rr=l("td",{class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},null,-1),lr={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid min-w-[150px]"},or={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid min-w-[120px]"},sr=l("td",{class:"px-2 py-1 border-b-1 border-b-black border-b-solid"},null,-1),ar={class:"min-w-[80px] border-r-1 border-r-black border-r-solid px-2 py-1"},tr={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},dr={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},nr={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},ir={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},cr={class:"border-r-1 border-r-black border-r-solid px-2 py-1 min-w-[100px]"},br={class:"border-r-1 border-r-black border-r-solid px-2 py-1 min-w-[100px]"},ur={class:"px-2 py-1 flex"},hr=re({__name:"users",async setup(H){let A,$;const p=Be(),v=Se(),{$api:E}=ae(),{t:a}=le(),{setLoading:f}=oe(),{setError:P}=se(),x=pe(),q=_e(),d=ve(),N=F(),T=F(10),L=F(0),I=B(()=>Number(x.query.page)||1),k=F([]),n=he({id:"",emailLike:"",firstNameLike:"",phoneNumberLike:"",level:null,active:null});let U=null;const u=B(()=>Math.ceil(L.value/T.value)),y=B(()=>i=>v.getBranchById(i)),m=B(()=>i=>{var r;return((r=y.value(i))==null?void 0:r.address)||""}),C=B(()=>i=>{var _,S;const r=(_=y.value(i))==null?void 0:_.locationId;return r===void 0?"":((S=p.getCityById(r))==null?void 0:S.name)||""||""});Y(()=>x.query,()=>{w()}),Y(()=>n,()=>{U&&(clearTimeout(U),U=null),U=setTimeout(async()=>{I.value===1?await w():q.push({path:d(x.path),query:{page:1}})},500)},{deep:!0}),[A,$]=fe(()=>w()),await A,$(),ke(async()=>{await v.fetchBranches(),await p.fetchCities()});async function w(){var i;try{f("global",!0);const{data:r}=await E.admin.getAdmins({query:we({size:T.value,page:I.value-1,authorityEqual:ge.ROLE_USER,codeEqual:n.id,emailLike:n.emailLike,firstNameLike:n.firstNameLike,phoneNumberLike:n.phoneNumberLike,active:n.active,level:n.level})});r.value&&(k.value=r.value.content,L.value=r.value.totalElements)}catch(r){(i=r==null?void 0:r.response)!=null&&i._data&&P({title:r.response._data.error||""})}finally{f("global",!1)}}function R(i){N.value?k.value=k.value.map(r=>r.id===i.id?i:r):k.value.unshift(i),J()}function O(i){N.value=i}async function M(i){var r;try{f("global",!0),await E.admin.removeAdmin(i.id)}catch(_){(r=_==null?void 0:_.response)!=null&&r._data&&P({title:_.response._data.error||""})}finally{f("global",!1)}}function J(){N.value=void 0}function te(i){q.push({path:d(x.path),query:{page:i}})}return(i,r)=>{const _=Pe,S=b("v-divider"),j=b("v-text-field"),K=b("v-select"),Q=b("v-tooltip"),W=b("v-icon"),X=b("v-btn"),de=b("v-table"),ne=b("v-pagination"),ie=b("v-container"),ce=ye("dragscroll");return h(),G(ie,null,{default:c(()=>[s(_,{"selected-user":e(N),onClear:J,onAdded:R},null,8,["selected-user"]),s(S,{inset:"",class:"my-4 !max-w-full !ms-0"}),l("div",qe,[l("span",null,t(e(a)("labels.totalCount")),1),V(": "),l("span",null,t(e(L)),1)]),xe((h(),z("div",Te,[s(de,{density:"comfortable",hover:!0,class:"table w-full mt-2 min-w-[1200px]"},{default:c(()=>[l("thead",Re,[l("tr",je,[Fe,l("th",De,t(e(a)("labels.user")),1),l("th",Oe,t(e(a)("labels.email")),1),l("th",Me,t(e(a)("labels.phoneNumber")),1),l("th",Ye,t(e(a)("labels.branch")),1),l("th",Ge,t(e(a)("labels.level")),1),l("th",He,t(e(a)("labels.active")),1),l("th",Je,t(e(a)("labels.commands")),1)])]),l("tbody",Ke,[l("tr",Qe,[l("td",We,[s(j,{modelValue:e(n).id,"onUpdate:modelValue":r[0]||(r[0]=o=>e(n).id=o),placeholder:e(a)("labels.search")},null,8,["modelValue","placeholder"])]),l("td",Xe,[s(j,{modelValue:e(n).firstNameLike,"onUpdate:modelValue":r[1]||(r[1]=o=>e(n).firstNameLike=o),placeholder:e(a)("labels.search")},null,8,["modelValue","placeholder"])]),l("td",Ze,[s(j,{modelValue:e(n).emailLike,"onUpdate:modelValue":r[2]||(r[2]=o=>e(n).emailLike=o),placeholder:e(a)("labels.search")},null,8,["modelValue","placeholder"])]),l("td",er,[s(j,{modelValue:e(n).phoneNumberLike,"onUpdate:modelValue":r[3]||(r[3]=o=>e(n).phoneNumberLike=o),placeholder:e(a)("labels.search")},null,8,["modelValue","placeholder"])]),rr,l("td",lr,[s(K,{value:e(n).level,label:e(a)("labels.filter"),"item-value":"value","item-title":"label",items:[{label:e(a)("labels.all"),value:""},...Object.values("LEVELS_TYPE"in i?i.LEVELS_TYPE:e(Ne)).map(o=>({label:o,value:o}))],"onUpdate:modelValue":r[4]||(r[4]=o=>e(n).level=o)},null,8,["value","label","items"])]),l("td",or,[s(K,{value:e(n).active,label:e(a)("labels.filter"),"item-value":"value","item-title":"label",items:[{value:"",label:e(a)("labels.all")},{value:!0,label:e(a)("labels.yes")},{value:!1,label:e(a)("labels.no")}],"onUpdate:modelValue":r[5]||(r[5]=o=>e(n).active=o)},null,8,["value","label","items"])]),sr]),(h(!0),z(Le,null,Ue(e(k),(o,be)=>{var Z;return h(),z("tr",{key:o.id,class:Ve(["w-full",{"bg-gray-300":be%2===0}])},[l("td",ar,t(o.id),1),l("td",tr,t(`${o.lastName} ${o.firstName}`),1),l("td",dr,t(o.email),1),l("td",nr,t(o.phoneNumber),1),l("td",ir,[l("div",null,t(`${e(C)(o.warehouseId)} - ${e(m)(o.warehouseId)}`),1),l("div",null,t((Z=e(y)(o.warehouseId))==null?void 0:Z.description),1)]),l("td",cr,[l("div",null,t(o.level),1)]),l("td",br,[l("div",null,t(o.active?e(a)("labels.yes"):e(a)("labels.no")),1)]),l("td",ur,[s(X,{variant:"plain",color:"primary",icon:!0,onClick:D(ue=>O(o),["stop"])},{default:c(()=>[s(Q,{activator:"parent",location:"top"},{default:c(()=>[V(t(e(a)("commands.select")),1)]),_:1}),s(W,{icon:"mdi mdi-button-pointer",size:"small"})]),_:2},1032,["onClick"]),s(X,{variant:"plain",color:"red",icon:!0,onClick:D(ue=>M(o),["stop"])},{default:c(()=>[s(Q,{activator:"parent",location:"top"},{default:c(()=>[V(t(e(a)("commands.delete")),1)]),_:1}),s(W,{icon:"mdi mdi-delete",size:"small"})]),_:2},1032,["onClick"])])],2)}),128))])]),_:1})])),[[ce]]),s(S,{inset:"",class:"my-4 !max-w-full !ms-0"}),e(u)>1?(h(),G(ne,{key:0,"model-value":e(I),length:e(u),size:"x-small","onUpdate:modelValue":r[6]||(r[6]=o=>te(o))},null,8,["model-value","length"])):Ce("",!0)]),_:1})}}});export{hr as default};
