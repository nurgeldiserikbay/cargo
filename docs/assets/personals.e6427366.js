import{v as _e,_ as fe}from"./index.db87a38f.js";import{_ as he}from"./SelectCity.vue.271ed348.js";import{_ as ve}from"./SelectBranch.vue.75abafe7.js";import{d as ae,u as le,a as te,b as de,k as M,w as Q,A as se,r as p,o as T,c as W,e as t,f as o,g as G,t as b,h as e,m as $,s as ke,i as X,j as ne,B as ge,C as ye,D as Ne,l as F,E as we,n as Ie,G as xe,R as Le,x as r,p as re,q as Ve,F as ze,v as Ce,H as $e,I as Ue,J as Ae}from"./entry.1b7bb521.js";import{t as Be,z as x,u as Se,a as U}from"./vee-validate-zod.esm.7220fb46.js";import{u as Pe}from"./branch.f442fae5.js";import{u as Ee}from"./location.545a2dad.js";const Re=ae({__name:"CreatePersonal",props:{selectedUser:{}},emits:["clear","added"],setup(Y,{emit:j}){const{$api:A}=ne(),{t:_}=le(),N=Y,B=j,{setLoading:i}=te(),{setError:w,setSuccess:S}=de(),H=Be(x.object({firstName:x.string().min(1).max(200),lastName:x.string().min(1).max(200),password:x.string().min(4),phoneNumber:x.string().refine(n=>_e.isMobilePhone(n.replace(/\D/g,""),"kk-KZ")),warehouseId:x.number(),email:x.string().email()})),{errors:h,values:d,handleSubmit:J,defineComponentBinds:f,handleReset:P,setValues:D}=Se({validationSchema:H}),E=f("firstName"),m=f("lastName"),L=f("phoneNumber"),v=f("password"),O=f("warehouseId"),R=f("email"),V=M();Q(()=>N.selectedUser,()=>{N.selectedUser&&D(N.selectedUser)});const K=J(async()=>{var n,I;try{if(!d.firstName||!d.lastName||!d.phoneNumber||!d.password||!d.email||!d.warehouseId)return;i("global",!0);const{status:c,data:z,error:g}=N.selectedUser?await A.admin.updateAdmin(N.selectedUser.id,{firstName:d.firstName,lastName:d.lastName,phoneNumber:se(d.phoneNumber||""),password:d.password,email:d.email,warehouseId:d.warehouseId}):await A.admin.createAdmin({firstName:d.firstName,lastName:d.lastName,phoneNumber:se(d.phoneNumber||""),password:d.password,email:d.email,warehouseId:d.warehouseId});c.value==="success"&&(B("added",z.value),S({title:_("messages.successAdminCreate")}),P()),c.value==="error"&&w({title:_(`errors.${((n=g.value)==null?void 0:n.data)||""}`)})}catch(c){(I=c==null?void 0:c.response)!=null&&I._data&&w({title:c.response._data.error||""})}finally{i("global",!1)}},()=>{});function q(){P(),B("clear")}return(n,I)=>{const c=p("v-col"),z=p("v-row"),g=p("v-text-field"),a=fe,s=he,k=ve,u=p("v-btn"),y=p("v-container"),C=p("v-form");return T(),W(C,null,{default:t(()=>[o(y,null,{default:t(()=>[o(z,{class:"text-h6 text-left",justify:"space-between"},{default:t(()=>[o(c,null,{default:t(()=>[G(b(e(_)("titles.personal")),1)]),_:1})]),_:1}),o(z,{align:"stretch"},{default:t(()=>[o(c,{cols:"12",md:"3"},{default:t(()=>[o(g,$(e(E),{label:e(_)("labels.firstName"),"error-messages":("zodI18n"in n?n.zodI18n:e(U))(e(h).firstName)}),null,16,["label","error-messages"])]),_:1}),o(c,{cols:"12",md:"3"},{default:t(()=>[o(g,$(e(m),{label:e(_)("labels.lastName"),"error-messages":("zodI18n"in n?n.zodI18n:e(U))(e(h).lastName)}),null,16,["label","error-messages"])]),_:1}),o(c,{cols:"12",md:"3"},{default:t(()=>[o(a,$(e(L),{label:e(_)("labels.phoneNumber"),"error-messages":("zodI18n"in n?n.zodI18n:e(U))(e(h).phoneNumber)}),null,16,["label","error-messages"])]),_:1}),o(c,{cols:"12",md:"3"},{default:t(()=>[o(g,$(e(R),{label:e(_)("labels.email"),"error-messages":("zodI18n"in n?n.zodI18n:e(U))(e(h).email)}),null,16,["label","error-messages"])]),_:1}),o(c,{cols:"12",md:"4"},{default:t(()=>[o(g,$(e(v),{label:e(_)("labels.password"),"error-messages":("zodI18n"in n?n.zodI18n:e(U))(e(h).password)}),null,16,["label","error-messages"])]),_:1}),o(c,{cols:"12",md:"4"},{default:t(()=>[o(s,{modelValue:e(V),"onUpdate:modelValue":I[0]||(I[0]=Z=>ke(V)?V.value=Z:null)},null,8,["modelValue"])]),_:1}),o(c,{cols:"12",md:"4"},{default:t(()=>[o(k,$(e(O),{"city-id":e(V),errors:("zodI18n"in n?n.zodI18n:e(U))(e(h).warehouseId)}),null,16,["city-id","errors"])]),_:1}),o(c,{cols:"12",md:"4",class:"flex center gap-5"},{default:t(()=>[o(u,{variant:"elevated",type:"submit",color:"secondary",size:"x-large",onClick:X(e(K),["prevent"])},{default:t(()=>[G(b(n.selectedUser?e(_)("commands.update"):e(_)("commands.submit")),1)]),_:1},8,["onClick"]),o(u,{variant:"elevated",color:"error",size:"x-large",onClick:X(q,["prevent"])},{default:t(()=>[G(b(e(_)("commands.clear")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),qe={class:"w-full"},Fe={class:"w-full"},Me=r("th",{class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"}," â„– ",-1),Te={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},je={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},De={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Oe={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Ge={class:"px-2 py-1 border-b-1 border-b-black border-b-solid"},He={class:"w-full"},Je={class:"w-full"},Ke={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Ze={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Qe={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},We={class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},Xe=r("td",{class:"border-r-1 border-r-black border-r-solid px-2 py-1 border-b-1 border-b-black border-b-solid"},null,-1),Ye=r("td",{class:"px-2 py-1 border-b-1 border-b-black border-b-solid"},null,-1),eo={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},oo={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},so={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},ro={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},ao={class:"border-r-1 border-r-black border-r-solid px-2 py-1"},lo={class:"px-2 py-1 flex"},_o=ae({__name:"personals",async setup(Y){let j,A;const _=Ee(),N=Pe(),{$api:B}=ne(),{t:i}=le(),{setLoading:w}=te(),{setError:S,setSuccess:H}=de(),h=ge(),d=ye(),J=Ne(),f=M(),P=M(10),D=M(0),E=F(()=>Number(h.query.page)||1),m=we({id:"",emailLike:"",firstNameLike:"",phoneNumberLike:""});let L=null;const v=M([]),O=F(()=>Math.ceil(D.value/P.value)),R=F(()=>a=>N.getBranchById(a)),V=F(()=>a=>{var s;return((s=R.value(a))==null?void 0:s.address)||""}),K=F(()=>a=>{var k,u;const s=(k=R.value(a))==null?void 0:k.locationId;return s===void 0?"":((u=_.getCityById(s))==null?void 0:u.name)||""||""});Q(()=>E.value,()=>{q()}),Q(()=>m,()=>{L&&(clearTimeout(L),L=null),L=setTimeout(()=>{q()},500)},{deep:!0}),[j,A]=Ie(()=>q()),await j,A();async function q(){var a;try{w("global",!0);const{data:s}=await B.admin.getAdmins({query:xe({size:P.value,page:E.value-1,authorityEqual:Le.ROLE_MANAGER,codeEqual:m.id,emailLike:m.emailLike,firstNameLike:m.firstNameLike,phoneNumberLike:m.phoneNumberLike})});s.value&&(v.value=s.value.content,D.value=s.value.totalElements)}catch(s){(a=s==null?void 0:s.response)!=null&&a._data&&S({title:s.response._data.error||""})}finally{w("global",!1)}}function n(a){f.value?v.value=v.value.map(s=>s.id===a.id?a:s):v.value.unshift(a),c()}function I(a){f.value=a}function c(){f.value=void 0}async function z(a){var s,k;try{w("global",!0);const{status:u,error:y}=await B.admin.updateAdmin(a.id,{...a,locked:!a.locked});u.value==="success"&&(v.value=v.value.filter(C=>C.id!==a.id),H({title:i("messages.successAdminRemove")})),u.value==="error"&&S({title:i(`errors.${((s=y.value)==null?void 0:s.data)||""}`)})}catch(u){(k=u==null?void 0:u.response)!=null&&k._data&&S({title:u.response._data.error||""})}finally{w("global",!1)}}function g(a){d.push({path:J(h.path),query:{page:a}})}return(a,s)=>{const k=Re,u=p("v-divider"),y=p("v-text-field"),C=p("v-tooltip"),Z=p("v-icon"),ce=p("v-btn"),ie=p("v-switch"),ue=p("v-table"),be=p("v-pagination"),me=p("v-container");return T(),W(me,null,{default:t(()=>[o(k,{"selected-user":e(f),onClear:c,onAdded:n},null,8,["selected-user"]),o(u,{inset:"",class:"my-4 !max-w-full !ms-0"}),o(ue,{density:"comfortable",hover:!0,class:"table w-full mt-2"},{default:t(()=>[r("thead",qe,[r("tr",Fe,[Me,r("th",Te,b(e(i)("labels.user")),1),r("th",je,b(e(i)("labels.email")),1),r("th",De,b(e(i)("labels.phoneNumber")),1),r("th",Oe,b(e(i)("labels.branch")),1),r("th",Ge,b(e(i)("labels.commands")),1)])]),r("tbody",He,[r("tr",Je,[r("td",Ke,[o(y,{modelValue:e(m).id,"onUpdate:modelValue":s[0]||(s[0]=l=>e(m).id=l),placeholder:e(i)("labels.search")},null,8,["modelValue","placeholder"])]),r("td",Ze,[o(y,{modelValue:e(m).firstNameLike,"onUpdate:modelValue":s[1]||(s[1]=l=>e(m).firstNameLike=l),placeholder:e(i)("labels.search")},null,8,["modelValue","placeholder"])]),r("td",Qe,[o(y,{modelValue:e(m).emailLike,"onUpdate:modelValue":s[2]||(s[2]=l=>e(m).emailLike=l),placeholder:e(i)("labels.search")},null,8,["modelValue","placeholder"])]),r("td",We,[o(y,{modelValue:e(m).phoneNumberLike,"onUpdate:modelValue":s[3]||(s[3]=l=>e(m).phoneNumberLike=l),placeholder:e(i)("labels.search")},null,8,["modelValue","placeholder"])]),Xe,Ye]),(T(!0),re(ze,null,Ve(e(v),(l,pe)=>{var ee;return T(),re("tr",{key:l.id,class:$e(["w-full",{"bg-gray-300":pe%2===0}])},[r("td",eo,b(l.id),1),r("td",oo,b(`${l.lastName} ${l.firstName}`),1),r("td",so,b(l.email),1),r("td",ro,b(l.phoneNumber),1),r("td",ao,[r("div",null,b(`${e(K)(l.warehouseId)} - ${e(V)(l.warehouseId)}`),1),r("div",null,b((ee=e(R)(l.warehouseId))==null?void 0:ee.description),1)]),r("td",lo,[o(ce,{variant:"plain",color:"primary",icon:!0,onClick:X(oe=>I(l),["stop"])},{default:t(()=>[o(C,{activator:"parent",location:"top"},{default:t(()=>[G(b(e(i)("commands.select")),1)]),_:1}),o(Z,{icon:"mdi mdi-button-pointer",size:"small"})]),_:2},1032,["onClick"]),o(C,{color:"black",location:"top"},{activator:t(({props:oe})=>[r("div",Ue(Ae(oe)),[o(ie,{"model-value":!l.locked,"hide-details":"",size:"small","onUpdate:modelValue":to=>z(l)},null,8,["model-value","onUpdate:modelValue"])],16)]),default:t(()=>[r("div",null,b(l.locked?e(i)("lables.unlock"):e(i)("labels.lock")),1)]),_:2},1024)])],2)}),128))])]),_:1}),o(u,{inset:"",class:"my-4 !max-w-full !ms-0"}),e(O)>1?(T(),W(be,{key:0,"model-value":e(E),length:e(O),size:"x-small","onUpdate:modelValue":s[4]||(s[4]=l=>g(l))},null,8,["model-value","length"])):Ce("",!0)]),_:1})}}});export{_o as default};
