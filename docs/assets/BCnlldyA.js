import{d as Z,u as G,a as J,b as Q,L as B,l as W,w as se,r as s,o as C,c as j,e as o,f as e,g as _,t as p,h as t,m as U,i as H,j as X,k as E,n as le,p as ce,q as re,s as Y,F as ie,v as de,x as ue,y as me}from"./enCeUreN.js";import{t as _e,z as T,u as pe,a as q}from"./CCLonOj_.js";import{_ as ve}from"./CWvqi8Xe.js";const fe=Z({__name:"CreateLocation",props:{selectedLocation:{}},emits:["clear","added"],setup(K,{emit:f}){const{$api:x}=X(),{t:c}=G(),i=K,k=f,{setLoading:z}=J(),{setError:I,setSuccess:g}=Q(),y=_e(T.object({name:T.string().min(1).max(500),code:T.string().min(1).max(500),type:T.enum([B.BORDER,B.CHINA,B.KZ])})),{errors:b,values:n,handleSubmit:N,defineComponentBinds:h,handleReset:S,setValues:R}=pe({validationSchema:y}),V=h("name"),D=h("type"),d=h("code"),u=W(()=>Object.values(B).filter(a=>a!=="NULL").map(a=>({id:a,label:c("places."+a)})));se(()=>i.selectedLocation,()=>{i.selectedLocation&&R(i.selectedLocation)});const w=N(async()=>{var a,m;try{if(!n.name||!n.type||!n.code)return;z("global",!0);const{status:l,data:v,error:L}=i.selectedLocation?await x.location.updateLocation(i.selectedLocation.id,{name:n.name,code:n.code,type:n.type}):await x.location.createLocation({name:n.name,code:n.code,type:n.type});l.value==="success"&&(k("added",v.value),g({title:c("messages.successLocationCreate")}),S()),l.value==="error"&&I({title:c(`errors.${((a=L.value)==null?void 0:a.data)||""}`)})}catch(l){(m=l==null?void 0:l.response)!=null&&m._data&&I({title:l.response._data.error||""})}finally{z("global",!1)}},()=>{});function r(){S(),k("clear")}return(a,m)=>{const l=s("v-col"),v=s("v-row"),L=s("v-text-field"),F=s("v-select"),A=s("v-btn"),O=s("v-container"),P=s("v-form");return C(),j(P,null,{default:o(()=>[e(O,null,{default:o(()=>[e(v,{class:"text-h6 text-left",justify:"space-between"},{default:o(()=>[e(l,null,{default:o(()=>[_(p(t(c)("titles.locations")),1)]),_:1})]),_:1}),e(v,{align:"stretch"},{default:o(()=>[e(l,{cols:"12",md:"4"},{default:o(()=>[e(L,U(t(V),{label:t(c)("labels.cityName"),"error-messages":("zodI18n"in a?a.zodI18n:t(q))(t(b).name),"hide-details":""}),null,16,["label","error-messages"])]),_:1}),e(l,{cols:"12",md:"4"},{default:o(()=>[e(F,U(t(D),{label:t(c)("labels.cityType"),items:t(u),"item-value":"id","item-title":"label","error-messages":("zodI18n"in a?a.zodI18n:t(q))(t(b).type)}),null,16,["label","items","error-messages"])]),_:1}),e(l,{cols:"12",md:"4"},{default:o(()=>[e(L,U(t(d),{label:t(c)("labels.code"),"error-messages":("zodI18n"in a?a.zodI18n:t(q))(t(b).code),"hide-details":""}),null,16,["label","error-messages"])]),_:1}),e(l,{cols:"12",md:"4",class:"flex center gap-5"},{default:o(()=>[e(A,{variant:"elevated",type:"submit",color:"secondary",size:"x-large",onClick:H(t(w),["prevent"])},{default:o(()=>[_(p(a.selectedLocation?t(c)("commands.update"):t(c)("commands.submit")),1)]),_:1},8,["onClick"]),e(A,{variant:"elevated",color:"error",size:"x-large",onClick:H(r,["prevent"])},{default:o(()=>[_(p(t(c)("commands.clear")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),ge={class:"overflow-y-hidden w-full hidden-scroll select-none"},we=Z({__name:"locations",async setup(K){let f,x;const{$api:c}=X(),{t:i}=G(),{setLoading:k}=J(),{setError:z,setSuccess:I}=Q(),g=E(),y=E(1),b=E(5),n=E([]),N=W(()=>Math.ceil(n.value.length/b.value)),{data:h}=([f,x]=le(()=>c.location.getLocations()),f=await f,x(),f);h.value&&(n.value=h.value);function S(d){g.value?n.value=n.value.map(u=>u.id===d.id?d:u):n.value.unshift(d),V()}function R(d){g.value=d}function V(){g.value=void 0}async function D(d){var u,w;try{k("global",!0);const{status:r,error:a}=await c.location.removeLocation(d.id);r.value==="success"&&(n.value=n.value.filter(m=>m.id!==d.id),I({title:i("messages.successLocationRemove")})),r.value==="error"&&z({title:i(`errors.${((u=a.value)==null?void 0:u.data)||""}`)})}catch(r){(w=r==null?void 0:r.response)!=null&&w._data&&z({title:r.response._data.error||""})}finally{k("global",!1)}}return(d,u)=>{const w=fe,r=s("v-divider"),a=s("v-col"),m=s("v-tooltip"),l=s("v-icon"),v=s("v-btn"),L=s("v-row"),F=s("v-list-item"),A=s("v-list"),O=ve,P=s("v-data-iterator"),ee=s("v-pagination"),te=s("v-container"),oe=ce("dragscroll");return C(),j(te,null,{default:o(()=>[e(w,{"selected-location":t(g),onClear:V,onAdded:S},null,8,["selected-location"]),e(r,{inset:"",class:"my-4 !max-w-full !ms-0"}),re((C(),Y("div",ge,[e(P,{items:t(n),page:t(y),"items-per-page":t(b),class:"min-w-[600px]"},{default:o(({items:M})=>[e(A,{variant:"elevated"},{default:o(()=>[(C(!0),Y(ie,null,de(M,($,ae)=>(C(),j(F,{key:ae,variant:"elevated",class:"mb-4 cursor-pointer",onClick:ne=>R($.raw)},{default:o(()=>[e(L,null,{default:o(()=>[e(a,{"align-self":"center",class:"border !border-r-2px !border-r-solid !border-r-color1"},{default:o(()=>[_(p($.raw.name),1)]),_:2},1024),e(a,{"align-self":"center"},{default:o(()=>[_(p(t(i)(`places.${$.raw.type}`)),1)]),_:2},1024),e(a,{"align-self":"center"},{default:o(()=>[_(p($.raw.code),1)]),_:2},1024),e(a,{class:"flex justify-end gap-2"},{default:o(()=>[e(v,{variant:"plain",color:"primary",icon:!0},{default:o(()=>[e(m,{activator:"parent",location:"top"},{default:o(()=>[_(p(t(i)("commands.select")),1)]),_:1}),e(l,{icon:"mdi mdi-button-pointer",size:"large"})]),_:1}),e(v,{variant:"plain",color:"error",icon:!0,class:"cursor-pointer",onClick:H(ne=>D($.raw),["stop"])},{default:o(()=>[e(m,{activator:"parent",location:"top"},{default:o(()=>[_(p(t(i)("commands.clear")),1)]),_:1}),e(l,{icon:"mdi mdi-delete",size:"large"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),"no-data":o(()=>[e(O)]),_:1},8,["items","page","items-per-page"])])),[[oe]]),e(r,{inset:"",class:"my-4 !max-w-full !ms-0"}),t(N)>1?(C(),j(ee,{key:0,modelValue:t(y),"onUpdate:modelValue":u[0]||(u[0]=M=>ue(y)?y.value=M:null),length:t(N),size:"x-small"},null,8,["modelValue","length"])):me("",!0)]),_:1})}}});export{we as default};
