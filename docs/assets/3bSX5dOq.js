import{d as K,u as Q,a as W,b as X,A as Y,l as I,k as P,w as Z,B as ee,r as b,o as k,c as S,e as o,j as re,f as t,g as d,t as s,h as r,s as oe,y as V,m as te,x as ae,i as $}from"./BL35Lc_y.js";import{t as se,z,u as le,a as de}from"./FrhPwdqL.js";import{u as ce}from"./CJIBvVXL.js";const ne={key:0},me=K({__name:"checkProduct",setup(ue){const g=ce(),{$api:y}=re(),{t:l}=Q(),{setLoading:_}=W(),{setError:p,setSuccess:T}=X(),{data:C}=Y(),A=I(()=>a=>g.getBranchById(a)),j=I(()=>a=>{var n;return((n=A.value(a))==null?void 0:n.address)||""}),F=se(z.object({trackCode:z.string().min(1).max(500)})),{errors:R,values:i,handleSubmit:D,defineComponentBinds:E,handleReset:x}=le({validationSchema:F}),L=E("trackCode"),h=P(!1),u=P(null);let f=null;Z(()=>i.trackCode,()=>{h.value&&(f&&clearTimeout(f),f=setTimeout(()=>{w()},300))}),ee(async()=>{await g.fetchBranches()});const M=D(()=>{f&&clearTimeout(f),w()},()=>{});function O(a){return a.split(" ")}async function U(){var a,n;try{if(!i.trackCode)return;_("global",!0);const{status:e,error:c,data:m}=await y.product.getProductOwnerById(i.trackCode);e.value==="success"&&(u.value=m.value,x()),e.value==="error"&&p({title:l(`errors.${((a=c.value)==null?void 0:a.data)||""}`)})}catch(e){(n=e==null?void 0:e.response)!=null&&n._data&&p({title:e.response._data.error||""})}finally{_("global",!1)}}async function w(){var a,n;try{if(!i.trackCode)return;_("global",!0);const e=O(i.trackCode),{status:c,error:m}=await y.product.updateByTrackCodes(e);c.value==="success"&&(T({title:l("messages.successProductRegistered")}),x()),c.value==="error"&&p({title:l(`errors.${((a=m.value)==null?void 0:a.data)||""}`)})}catch(e){(n=e==null?void 0:e.response)!=null&&n._data&&p({title:e.response._data.error||""})}finally{_("global",!1)}}return(a,n)=>{const e=b("v-col"),c=b("v-row"),m=b("v-text-field"),q=b("v-checkbox"),B=b("v-btn"),G=b("v-card"),H=b("v-form"),J=b("v-container");return k(),S(J,{class:"!pt-10"},{default:o(()=>[t(c,{class:"mb-10",justify:"space-between"},{default:o(()=>[t(e,{class:"text-h4 text-center"},{default:o(()=>{var v,N;return[d(s(r(l)("titles.checkProduct"))+" ",1),(v=r(C))!=null&&v.warehouseId?(k(),oe("span",ne,"("+s(r(j)((N=r(C))==null?void 0:N.warehouseId))+")",1)):V("",!0)]}),_:1})]),_:1}),t(H,{class:"max-w-500px m-auto flex flex-col"},{default:o(()=>[t(m,te(r(L),{label:r(l)("labels.trackCode"),"error-messages":("zodI18n"in a?a.zodI18n:r(de))(r(R).trackCode),"hide-details":"",clearable:!0,autofocus:!0,type:"textarea"}),null,16,["label","error-messages"]),t(q,{modelValue:r(h),"onUpdate:modelValue":n[0]||(n[0]=v=>ae(h)?h.value=v:null),label:r(l)("labels.autoFetch"),color:"indigo",value:"indigo","hide-details":"",class:"mb-5 self-end"},null,8,["modelValue","label"]),t(c,null,{default:o(()=>[t(B,{variant:"elevated",type:"submit",color:"secondary",size:"x-large",class:"m-auto",onClick:$(U,["prevent"])},{default:o(()=>[d(s(r(l)("labels.search")),1)]),_:1}),t(B,{variant:"elevated",type:"submit",color:"primary",size:"x-large",class:"m-auto",onClick:$(r(M),["prevent"])},{default:o(()=>[d(s(r(l)("commands.submit")),1)]),_:1},8,["onClick"])]),_:1}),r(u)?(k(),S(G,{key:0,class:"mt-8 px-4 py-2"},{default:o(()=>[t(c,null,{default:o(()=>[t(e,{class:"border-r-1 border-r-solid border-r-#000 border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(l)("labels.description")),1)]),_:1}),t(e,{class:"border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(`${r(u).productDescription}`),1)]),_:1})]),_:1}),t(c,null,{default:o(()=>[t(e,{class:"border-r-1 border-r-solid border-r-#000 border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(l)("labels.city")),1)]),_:1}),t(e,{class:"border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(u).locationName),1)]),_:1})]),_:1}),t(c,null,{default:o(()=>[t(e,{class:"border-r-1 border-r-solid border-r-#000 border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(l)("labels.branch")),1)]),_:1}),t(e,{class:"border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(u).warehouseName),1)]),_:1})]),_:1}),t(c,null,{default:o(()=>[t(e,{class:"border-r-1 border-r-solid border-r-#000 border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(l)("labels.fullName")),1)]),_:1}),t(e,{class:"border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(`${r(u).lastName} ${r(u).firstName}`),1)]),_:1})]),_:1}),t(c,null,{default:o(()=>[t(e,{class:"border-r-1 border-r-solid border-r-#000 border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(l)("labels.phoneNumber")),1)]),_:1}),t(e,{class:"border-b-1 border-b-solid border-b-#000"},{default:o(()=>[d(s(r(u).phoneNumber),1)]),_:1})]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1})}}});export{me as default};
